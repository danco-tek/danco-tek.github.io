(function(b){function h(){if(d=t.shift()){d.open({stopBits:0,bitRate:115200,ctsFlowControl:0});console.log("connection with "+d.id);d.set_receive_handler(v);var a=new Uint8Array([36,120,10,10,10,10]);d.send(a.buffer);k=setInterval(function(){d.send(a.buffer)},500);f=setTimeout(function(){l();d&&d.close();h()},2E3)}}function p(){f&&(clearTimeout(f),f=null)}function l(){k&&(clearInterval(k),k=null)}function v(a){a=new Uint8Array(a);36==a[0]&&68==a[1]&&(p(),l(),d.set_receive_handler(w),c.getMac(d),console.log("found "+
d.id))}function w(a){a=new Uint8Array(a);c.parse(a)}function x(a){e[0].updateS(a)}function y(a){e[1].updateS(Math.abs(a))}var c=null,e=[null,null],m=[null,null,null],d=null,k=null,f=null,t=[];b._deviceConnected=function(a){t.push(a);console.log("deviceConnected:"+a.id);d||h()};b._deviceRemoved=function(a){console.log("deviceRemoved:"+a.id);d==a&&(l(),p(),d&&d.close(),h())};b._shutdown=function(){console.log("shutdown:"+d.id);d&&d.close();l();p();d&&d.close();h()};b._getStatus=function(){return d?
f?{status:1,msg:"Probing for SmartBand"}:{status:2,msg:"SmartBand connected"}:{status:1,msg:"SmartBand disconnected"}};b.isBandConnect=function(a){return z[a]?c.dataConnected:!c.dataConnected};b.isBandConn=function(){return c.dataConnected};b.getBattery=function(){return c.battery};b.getRssi=function(){return c.rssi10};b.getBandName=function(){return c.mac};b.isPressed=function(){return c.isPressed()};b.isPressed2=function(){return c.isPressed()};b.getMouseX=function(){return c.getMouse(0)};b.getMouseY=
function(){return c.getMouse(1)};b.getHandZ=function(){return c.getHandZ()};b.getMouseXMS=function(a,g){return q[g]?m[0].smooth(c.getMouse(0)*a):c.getMouse(0)*a};b.getMouseYMS=function(a,g){return q[g]?m[1].smooth(c.getMouse(1)*a):c.getMouse(1)*a};b.getHandZAS=function(a,g){a=parseInt(a);return q[g]?m[2].smoothAngle(c.getHandZ()+a):c.getHandZ()+a};b.getForceAndPause=function(a,g,c){return e[0].isPowerGreater(a,g,c)};b.getRotateAndPause=function(a,c,b){return e[1].isPowerGreater(a,c,b)};b.getG0=function(){return e[0].getForce()};
b.pauseG0=function(a){e[0].pauseUpdateS(a)};b.getG1=function(){return e[1].getForce()};b.pauseG1=function(a){e[1].pauseUpdateS(a)};b.getShakeDirFB=function(a){c.checkFB=!0;var b=c.wayZ;return 5==n[a]?1==b:-1==b};b.getShakeDirLR=function(a){c.checkLR=!0;var b=c.wayCheckLR.getWay();return 4==n[a]?1==b:-1==b};b.getShakeDirTD=function(a){c.checkTD=!0;var b=c.wayCheckTD.getWay();return 1==n[a]?1==b:-1==b};b.getRotateLR=function(a){c.checkRZ=!0;var b=c.wayCheckRZ.getWay();return 4==n[a]?1==b:-1==b};b.doVibrate=
function(a,b,e){a=parseInt(a);b=r[b];c.vibrate(d,a,b);setTimeout(function(){e()},100*b+200)};b.doLedOn=function(a,b,e){a=u[a];b=parseInt(b);c.ledOn(d,a,b);setTimeout(function(){e()},500)};b.doLedOnPro=function(a,b,e,f){c.ledOnPro(d,parseInt(a),parseInt(b),parseInt(e));setTimeout(function(){f()},500)};b.doLedFlash=function(a,b,e,f,h){a=u[a];b=parseInt(b);c.ledFlash(d,a,r[e],r[f],b);setTimeout(function(){h()},500)};var z={"\u6210\u529f":!0,"\u4e2d\u65b7":!1},q={"\u958b":!0,"\u95dc":!1},n={"\u4e0a":1,
"\u4e0b":2,"\u5de6":3,"\u53f3":4,"\u524d":5,"\u5f8c":6},u={"\u7d05":0,"\u7da0":1,"\u85cd":2},r={"0.1":1,"0.2":2,"0.3":3,"0.4":4,"0.5":5,"0.6":6,"0.7":7,"0.8":8,"0.9":9},A={blocks:[["r","\u7a7a\u4e2d\u6ed1\u9f20 X * %n , \u5e73\u6ed1 %m.onOff","getMouseXMS",400,"\u958b"],["r","\u7a7a\u4e2d\u6ed1\u9f20 Y * %n , \u5e73\u6ed1 %m.onOff","getMouseYMS",300,"\u958b"],["r","\u624b\u8155\u65cb\u8f49\u89d2\u5ea6 + %d.angle , \u5e73\u6ed1 %m.onOff","getHandZAS",0,"\u958b"],["r","\u7a7a\u4e2d\u6ed1\u9f20 X (-1~1)",
"getMouseX"],["r","\u7a7a\u4e2d\u6ed1\u9f20 Y (-1~1)","getMouseY"],["r","\u624b\u8155\u65cb\u8f49\u89d2\u5ea6 (-180~180)","getHandZ"],["-"],["h","\u7576\u6309\u4e0b\u624b\u74b0\u6309\u9215","isPressed"],["b","\u6309\u4e0b\u4e86\u624b\u74b0\u6309\u9215","isPressed2"],["-"],["w","\u8b93\u624b\u74b0\u9707\u52d5 \u5f37\u5ea6: %d.powerV \u79d2\u6578: %d.second","doVibrate",5,.5],["w","\u8b93\u624b\u74b0\u4eae %m.color3 \u71c8 \u4eae\u5ea6: %d.light9","doLedOn","\u85cd",5],["w","\u8b93\u624b\u74b0\u9583 %m.color3 \u71c8 \u4eae\u5ea6: %d.light9 \u4eae %d.second \u79d2, \u6697 %d.second \u79d2",
"doLedFlash","\u7da0",5,.3,.3],["w","\u540c\u6642\u4eae\u71c8 \u7d05\u71c8\u4eae\u5ea6: %d.light10 , \u7da0\u71c8\u4eae\u5ea6: %d.light10 , \u85cd\u71c8\u4eae\u5ea6: %d.light10","doLedOnPro",0,0,5],["-"],["h","\u7576\u624b\u8155\u65cb\u8f49\u7684 \u901f\u5ea6\u5927\u65bc %n , \u52a0\u901f\u5927\u65bc %n , \u66ab\u505c\u5075\u6e2c %n \u79d2","getRotateAndPause",30,15,.5],["r","\u624b\u8155\u65cb\u8f49\u7684\u901f\u5ea6","getG1"],[" ","\u66ab\u505c\u5075\u6e2c \u624b\u8155\u65cb\u8f49 %d \u79d2","pauseG1",
.5],["b","\u624b\u8155\u5411 %m.wayLR \u65cb\u8f49","getRotateLR","\u53f3"],["-"],["h","\u7576\u63ee\u624b\u7684 \u901f\u5ea6\u5927\u65bc %n , \u52a0\u901f\u5927\u65bc %n , \u66ab\u505c\u5075\u6e2c %n \u79d2","getForceAndPause",1,.3,.3],["r","\u63ee\u624b\u7684\u901f\u5ea6","getG0"],[" ","\u66ab\u505c\u5075\u6e2c \u63ee\u624b %n \u79d2","pauseG0",.5],["b","\u624b\u5411 %m.wayTD \u63ee (\u4e0a\u4e0b)","getShakeDirTD","\u4e0a"],["b","\u624b\u5411 %m.wayLR \u63ee (\u5de6\u53f3)","getShakeDirLR","\u5de6"],
["b","\u624b\u5411 %m.wayFB \u63ee (\u524d\u5f8c)","getShakeDirFB","\u524d"],["-"],["h","\u7576\u624b\u74b0\u9023\u7dda %m.connect","isBandConnect","\u4e2d\u65b7"],["b","\u624b\u74b0\u9023\u63a5\u4e0a\u96fb\u8166","isBandConn"],["-"],["r","\u624b\u74b0\u96fb\u91cf (0~100)","getBattery"],["r","\u8a0a\u865f\u5f37\u5ea6 (0~10)","getRssi"],["r","\u624b\u74b0\u865f\u78bc","getBandName"]],menus:{connect:["\u6210\u529f","\u4e2d\u65b7"],onOff:["\u958b","\u95dc"],wayTD:["\u4e0a","\u4e0b"],wayLR:["\u5de6",
"\u53f3"],wayFB:["\u524d","\u5f8c"],color3:["\u7d05","\u7da0","\u85cd"],powerV:"456789".split(""),second:"0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9".split(" "),light9:"123456789".split(""),light10:"0123456789".split(""),angle:["0","90","180","270"]},url:"http://danco-tek.com/scratch/"};(function(){$.when($.getScript("http://danco-tek.github.io/scratchx/lib/gl-matrix-min.js"),$.getScript("http://danco-tek.github.io/scratchx/lib/dc01u.js"),$.Deferred(function(a){$(a.resolve)})).done(function(){console.log("Loading completed");
c||(e=[new ShakeGesture,new ShakeGesture],m=[new Smoother,new Smoother,new Smoother],c=new PData,c.onDataL=x,c.onDataZ=y);ScratchExtensions.register("danco-tek SmartBand",A,b,{type:"serial"})})})()})({});